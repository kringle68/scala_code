=================================
XT 2.06 Release Instructions
=================================

Release Date:       2009/09/15
Downtime Required:	YES


These instructions are meant to be used with those detailed in confluence:

    http://confluence.net-a-porter.com/display/DEV/XT+Deployment#XTDeployment-XTApplicationdeployment


====================
Release Dependencies
====================

Please specify related JIRA tickets where possible.

Website
-------

None

Fulcrum
----

None


=========================
Point Release Information
=========================

2.06.01
=======

    This release will follow a slightly different release process as there are
    a lot of third party dependencies that we need to include.

    This is a temporary yet necessary way of deploying for now as we are working on a way of 
    automating most of this.
    
    Please read the notes below...

2.06.02
=======

    If the previous steps described for installing the 2.06.01 release have been done, one should only require to run:

    xt_deploy 2.06.02 {DC1,DC2} <ENVIRONMENT>


2.06.03
=======

    -Run steps described for installing the 2.06.01 release has these steps take care of the binary dependencies we have in place.
    -Make sure you get the newly update xt_deploy script from here.
    
	wget -nv -O /tmp/xt_deploy.sh http://10.3.2.89/cobbler/localmirror/scripts/xt_deploy.sh

    -Run xt_deploy with the new option for the host

    xt_deploy 2.06.03 {DC1,DC2} <ENVIRONMENT> <DB_HOST>

==============================================
Before The Code Release (downtime required)
==============================================

For 2.06.01 release and for when installing in Live.

1. Config Files
---------------

- Backup previous config files as pointed to by the links 
/opt/xt/conf and /opt/xt/local-conf

- Create a directories in etc that will hold these config files temporarily 
mkdir -p /etc/xt/conf
mkdir -p /etc/xt/local-conf

-Copy the config file dirs into these new directories
rsync -av -P --stats /opt/xt/conf/ /etc/xt/conf/
rsync -av -P --stats /opt/xt/local-conf/ /etc/xt/local-conf/

1.1 Stop Jobqueue and apache

/opt/xt/xt-server/bin/apachectl stop
sudo -u nobody /opt/xt/deploy/xtracker/script/job_queue_worker stop

2. Nuke /opt

-Evaluate what are the current permission settings before nuking the directory
-Clean "everything" e.g. xt from /opt

3. Get the new XT Binaries and extract them

wget -nv -O /tmp/xt-bin-2.06.01.tar.gz http://mystique/dist/xt-bin/xt-bin-2.06.01.tar.gz
tar -xzvf /tmp/xt-bin-2.06.01.tar.gz -C /opt

4 .Get XT release tarball 

wget -nv -O /tmp/xt-2.06.01.tar.gz http://mystique/dist/xt/xt-2.06.01.tar.gz
cp /tmp/xt-2.06.01.tar.gz /opt/xt/deploy


5. Set up symlinks

ln -s /etc/xt/conf /opt/xt/conf
ln -s /etc/xt/local-conf /opt/xt/local-conf
ln -s /tmp/mock /opt/xt/deploy/xtracker

5.1 Touch these files as they will be created as root otherwise
touch /opt/xt/logs/xtracker.log /opt/xt/logs/xtracker-response.log /opt/xt/logs/xtracker_data_transfer.log

5.2 Add new PATH settings

-Add this new line to your profile
export PATH=/opt/xt/xt-perl/bin:/opt/xt/arch-64/xt-support/htmldoc/bin:$PATH

-Export this new PATH into your shell as well


6. Set up the right permissions for /opt

-We need to set the permission as we observed in point 2.
chown -R ${xtracker_user}.${xtracker_user} /opt

7. Get our customized xt_deploy

- Check what the current xt_deploy is linking against
wget -nv -O /tmp/xt_deploy.sh http://kingpinv03/cobbler/localmirror/scripts/xt_deploy.sh

- Replace the link to this new xt_deploy
- Copy it somewhere else if necessary

8. Run xt_deploy as usual

xt_deploy 2.06.01 {DC1,DC2} staging 


X. Lastly
---------

Paste any console output from the steps above as a

  {noformat}
  ...
  {noformat}

comment to the JIRA ticket for this release.

====================
For the Code Release
====================

Release XT, as described on:

    http://confluence.net-a-porter.com/display/DEV/XT+Deployment


======================
After the Code Release
======================

As normal.
