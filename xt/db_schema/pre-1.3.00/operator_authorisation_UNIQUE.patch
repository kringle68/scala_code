-- Description:
--   adds unique constraint on operator permissions so that we don't insert
--   multiple permissions for the same section for the same operator
--
--
-- Checking for duplicates:
--   you might not be able to apply this patch because there are already
--   duplicates, here's the SQL to list them
--
--   SELECT operator_id,authorisation_sub_section_id, count(*) AS tally
--     FROM operator_authorisation
--    GROUP BY operator_authorisation.operator_id,
--             operator_authorisation.authorisation_sub_section_id
--    HAVING count(*) > 1
--    ORDER BY tally DESC, operator_id, authorisation_sub_section_id;

BEGIN;

ALTER TABLE operator_authorisation
ADD UNIQUE (operator_id,authorisation_sub_section_id)
;

COMMIT;
